<?xml version="1.0"?>
<launch>
  <!-- map server -->

  <group ns="robot_0">
    <arg name="map" default="/home/banos/catkin_ws/src/navigation_experimets/multi_stage/map.yaml" />

    <node name="tf_map_robot_0" pkg="tf" type="static_transform_publisher" args=" 0 0 0 0 0 0 robot_0/map robot_0/odom 100" respawn="false" />
    <node name="tf_map_odom_0" pkg="tf" type="static_transform_publisher" args=" 0 0 0 0 0 0 map robot_0/map 100" respawn="false" />

    <node name="map_server" pkg="map_server" type="map_server" args="$(arg map)" respawn="false" >
      <param name="frame_id" value="map" /> <!-- Here -->
    </node>

    <node name="local_map_server" pkg="map_server" type="map_server"
          args="$(arg map)" output="screen" respawn="true">
        <remap from="map" to="local_map"/>
    </node>

    <remap from="/scan_front" to="/robot_0/base_scan_0"/>
    <remap from="/scan_rear" to="/robot_0/base_scan_1"/>

    <arg name="input_scans" default="[/robot_0/base_scan_0, /robot_0/base_scan_1]"/>
    <!--remap from="map" to="/map"/-->
    <!--param name="tf_prefix" value="robot_0" /-->
    <!-- particle filter localization -->
    <include file="/home/banos/catkin_ws/src/navigation_experimets/multi_stage/amcl_stage.launch" />

    <node pkg="mbf_costmap_nav" type="mbf_costmap_nav" name="move_base_flex" output="screen" respawn="true">
      <rosparam file="cman:move_base_flex/move_base_flex.yaml" command="load"/>
      <param name="robot_frame" value="robot_0/base_footprint"/>
      <param name="global_frame" value="robot_0/map"/>
      <rosparam param="global_frame_id" command="load" ns="OrientedDWAPlanner"> "robot_0/map" </rosparam>
      <rosparam param="global_frame" command="load" ns="global_costmap"> "robot_0/map" </rosparam>
      <rosparam param="robot_base_frame" command="load" ns="global_costmap"> "robot_0/base_footprint" </rosparam>
      <rosparam param="global_frame" command="load" ns="local_costmap"> "robot_0/map" </rosparam>
      <rosparam param="robot_base_frame" command="load" ns="local_costmap"> "robot_0/base_footprint" </rosparam>
    </node>

    <node pkg="mbf_costmap_nav" type="move_base_legacy_relay.py" name="move_base_legacy_relay_0" output="screen" respawn="true">
  </node>

    <!--node pkg="cob_scan_unifier" type="scan_unifier_node" name="scan_unifier" output="log">
        <rosparam subst_value="True" param="input_scans">$(arg input_scans)</rosparam>
    </node-->
    <node pkg="multi_robots_comm" type="client.py" name="move_base_comm_client_0" output="screen" respawn="true">
    </node>
  </group>






  <group ns="robot_1">
    <arg name="map" default="/home/banos/catkin_ws/src/navigation_experimets/multi_stage/map.yaml" />

    <node name="map_server" pkg="map_server" type="map_server" args="$(arg map)" respawn="false" >
      <param name="frame_id" value="map" /> <!-- Here -->
    </node>

    <node name="tf_map_robot_1" pkg="tf" type="static_transform_publisher" args=" 0 0 0 0 0 0 robot_1/map robot_1/odom 100" respawn="false" />
    <node name="tf_map_odom_1" pkg="tf" type="static_transform_publisher" args=" 0 0 0 0 0 0 map robot_1/map 100" respawn="false" />

    <node name="local_map_server" pkg="map_server" type="map_server"
          args="$(arg map)" output="screen" respawn="true">
        <remap from="map" to="local_map"/>
    </node>

    <remap from="/scan_front" to="/robot_1/base_scan_0"/>
    <remap from="/scan_rear" to="/robot_1/base_scan_1"/>

    <arg name="input_scans" default="[/robot_1/base_scan_0, /robot_1/base_scan_1]"/>
    <!--remap from="map" to="/map"/-->
    <!--param name="tf_prefix" value="robot_1" /-->
    <!-- particle filter localization -->
    <include file="/home/banos/catkin_ws/src/navigation_experimets/multi_stage/amcl_stage_2.launch" >
    </include>

    <node pkg="mbf_costmap_nav" type="mbf_costmap_nav" name="move_base_flex" output="screen" respawn="true">
      <rosparam file="cman:move_base_flex/move_base_flex.yaml" command="load"/>
      <param name="robot_frame" value="robot_1/base_footprint"/>
      <param name="global_frame" value="robot_1/map"/>
      <rosparam param="global_frame_id" command="load" ns="OrientedDWAPlanner"> "robot_1/map" </rosparam>
      <rosparam param="global_frame" command="load" ns="global_costmap"> "robot_1/map" </rosparam>
      <rosparam param="robot_base_frame" command="load" ns="global_costmap"> "robot_1/base_footprint" </rosparam>
      <rosparam param="global_frame" command="load" ns="local_costmap"> "robot_1/map" </rosparam>
      <rosparam param="robot_base_frame" command="load" ns="local_costmap"> "robot_1/base_footprint" </rosparam>
    </node>

    <node pkg="mbf_costmap_nav" type="move_base_legacy_relay.py" name="move_base_legacy_relay_1" output="screen" respawn="true">
    </node>

    <!--node pkg="cob_scan_unifier" type="scan_unifier_node" name="scan_unifier" output="log">
        <rosparam subst_value="True" param="input_scans">$(arg input_scans)</rosparam>
    </node-->
  </group>




</launch>
